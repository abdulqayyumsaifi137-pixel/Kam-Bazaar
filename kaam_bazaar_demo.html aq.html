<!DOCTYPE html>
<html lang="ur" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ú©Ø§Ù… Ø¨Ø§Ø²Ø§Ø± - Ù…Ú©Ù…Ù„ ÚˆÛŒÙ…Ùˆ</title>
  <meta name="description" content="Ú©Ø§Ù… Ø¨Ø§Ø²Ø§Ø± - Ø³ÛŒÚ©Ú¾ÙˆØŒ Ú©Ø§Ù… Ú©Ø±ÙˆØŒ Ú©Ù…Ø§Ø¤Û” ÚˆÛŒÙ…Ùˆ ÙˆØ±Ú˜Ù† (EasyPaisa/JazzCash integration placeholders included)." />
  <style>
    /* Ø³Ø§Ø¯Û Ù…ÙˆØ¨Ø§Ø¦Ù„ ÙØ±ÛŒÙ†ÚˆÙ„ÛŒ Ø§Ø³Ù¹Ø§Ø¦Ù„ */
    :root{--primary:#0d6efd;--muted:#6c757d}
    body{font-family:system-ui, -apple-system, "Segoe UI", Roboto, "Noto Nastaliq Urdu", sans-serif; margin:0; background: linear-gradient(180deg,#f7fbff,#eef7ff); color:#111}
    .container{max-width:900px;margin:18px auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{width:48px;height:48px;border-radius:10px;background:var(--primary);color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{font-size:20px;margin:0}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    .nav-btn{background:#fff;border:1px solid #e6edf8;padding:8px 12px;border-radius:10px;text-decoration:none;color:var(--primary);cursor:pointer}
    .card{background:#fff;border-radius:12px;padding:14px;margin-top:14px;box-shadow:0 6px 18px rgba(13,110,253,0.06)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 240px;min-width:220px}
    .muted{color:var(--muted);font-size:13px}
    .btn{background:var(--primary);color:#fff;padding:8px 12px;border-radius:10px;border:none;cursor:pointer}
    .btn-ghost{background:#fff;border:1px solid #e6edf8;color:var(--primary)}
    input,select,textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6edf8;margin-top:6px}
    .task{border:1px dashed #e6edf8;padding:10px;border-radius:10px;margin-top:8px}
    .small{font-size:13px}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    .share-row{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .share-btn{padding:8px 12px;border-radius:20px;text-decoration:none;color:#fff}
    .fb{background:#3b5998}.wa{background:#25D366}.tw{background:#1DA1F2}
    .counter{display:inline-block;padding:8px 12px;background:#fff;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
    .label{font-weight:600}
    .center{text-align:center}
    .notice{background:#fffbe6;border:1px solid #fff0b3;padding:10px;border-radius:8px;margin-top:10px}
    /* responsive */
    @media(max-width:520px){header{flex-direction:column;align-items:flex-start;gap:10px}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">KB</div>
        <div>
          <h1>Ú©Ø§Ù… Ø¨Ø§Ø²Ø§Ø±</h1>
          <div class="muted small">Ø³ÛŒÚ©Ú¾Ùˆ â€¢ Ú©Ø§Ù… Ú©Ø±Ùˆ â€¢ Ú©Ù…Ø§Ø¤</div>
        </div>
      </div>

      <nav>
        <button class="nav-btn" onclick="showSection('home')">ÛÙˆÙ…</button>
        <button class="nav-btn" onclick="showSection('profile')">Ù…ÛŒØ±ÛŒ Ù¾Ø±ÙˆÙØ§Ø¦Ù„</button>
        <button class="nav-btn" onclick="showSection('tasks')">Ù¹Ø§Ø³Ú©</button>
        <button class="nav-btn" onclick="showSection('wallet')">ÙˆØ§Ù„Ù¹</button>
        <button class="nav-btn" onclick="showSection('admin')">Admin</button>
      </nav>
    </header>

    <!-- HOME -->
    <section id="home" class="card">
      <div class="center">
        <h2>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ â€” Ú©Ø§Ù… Ø¨Ø§Ø²Ø§Ø± (ÚˆÛŒÙ…Ùˆ)</h2>
        <p class="muted">ÛŒÛ ÙØ§Ø¦Ù„ Ù¾ÙˆØ±Ø§ Ø§ÛŒÚ© Ø¬Ú¯Û Ù…ÛŒÚº ØªÛŒØ§Ø± Ú©ÛŒ Ú¯Ø¦ÛŒ ÛÛ’Û” Ù†ÛŒÚ†Û’ Ù¾Ø±ÙˆÙØ§Ø¦Ù„ØŒ Ù¹Ø§Ø³Ú©Ø³ØŒ Ù¾ÛŒÙ…Ù†Ù¹ Ø§ÙˆØ± ÙˆÛŒÚˆØ±Ø§ÙˆÙ„ Ø³Ø¨ Ù…ÙˆØ¬ÙˆØ¯ ÛÛŒÚºÛ”</p>
        <div class="share-row" style="margin-top:8px">
          <a class="share-btn fb" href="#" onclick="share('facebook')">Facebook Ù¾Ø± Ø´ÛŒØ¦Ø±</a>
          <a class="share-btn wa" href="#" onclick="share('whatsapp')">WhatsApp Ø´ÛŒØ¦Ø±</a>
          <a class="share-btn tw" href="#" onclick="share('twitter')">X (Twitter)</a>
        </div>

        <div style="margin-top:12px">
          <span class="counter">ğŸ‘€ ÙˆØ²Ù¹Ø±Ø²: <span id="visCount">0</span></span>
        </div>
      </div>

      <div class="row" style="margin-top:16px">
        <div class="col card">
          <h3 class="label">Quick Start (Ø¬Ù„Ø¯ÛŒ)</h3>
          <ol class="small">
            <li>Ù¾ÛÙ„Û’ <b>Ù…ÛŒØ±ÛŒ Ù¾Ø±ÙˆÙØ§Ø¦Ù„</b> Ù…ÛŒÚº Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… Ø§ÙˆØ± Ù…ÙˆØ¨Ø§Ø¦Ù„ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚºÛ”</li>
            <li>Ù¾Ú¾Ø± <b>Ù¹Ø§Ø³Ú©</b> Ù…ÛŒÚº Ú©Ù„Ø§Ø¦Ù†Ù¹ Ú©Û’ Ø·ÙˆØ± Ù¾Ø± Ù†ÛŒØ§ Ù¹Ø§Ø³Ú© Ø¨Ù†Ø§Ø¦ÛŒÚº (Create Task)Û”</li>
            <li>Payment Ù¾Ø± Ú©Ù„Ú© Ú©Ø±ÛŒÚº â€” ÛŒÛ demo Ù…ÛŒÚº Wallet Ù…ÛŒÚº Ù¾ÛŒØ³Û’ ÚˆØ§Ù„Û’ Ú¯Ø§ (simulate)Û”</li>
            <li>Freelancer Ø¬Ø¨ Ú©Ø§Ù… Ù…Ú©Ù…Ù„ Ú©Ø±Û’ Ú¯Ø§ ØªÙˆ Ø¢Ù¾ Release Ú©Ø±ÛŒÚºØŒ Ø§ÙˆØ± Ù¾Ú¾Ø± ÙˆÛ Withdraw Ú©Ø± Ø³Ú©Û’ Ú¯Ø§Û”</li>
          </ol>
          <div class="notice small">Ù†ÙˆÙ¹: Ø­Ù‚ÛŒÙ‚ÛŒ EasyPaisa/JazzCash integration Ú©Û’ Ù„ÛŒÛ’ Ù†ÛŒÚ†Û’ ÙˆØ§Ù„Û’ Admin Ø³ÛŒÚ©Ø´Ù† Ù…ÛŒÚº placeholder Ø¯Ú©Ú¾Ø§Ø¦Û’ Ú¯Ø¦Û’ ÛÛŒÚº â€” ÙˆÛØ§Úº server-side code Ù„Ú¯Ø§Ù†Ø§ ÛÙˆÚ¯Ø§Û”</div>
        </div>

        <div class="col card">
          <h3 class="label">Ø¢Ø¬ Ú©ÛŒ Ø®Ø§Øµ Ø¨Ø§Øª</h3>
          <p class="small">Ø§Ù¾Ù†Ø§ reference link Ø¯ÙˆØ³ØªÙˆÚº Ú©Ùˆ Ø¯ÛŒÚº â€” Ø¬Ø¨ ÙˆÛ Ø¢Ø¦ÛŒÚº ØªÙˆ Ø¢Ù¾ Ú©Ø§ Ø§Ø¹ØªØ¨Ø§Ø± Ø¨Ú‘Ú¾Û’ Ú¯Ø§Û”</p>
          <input id="refLink" readonly value="https://abdulqayyumsaifi137-pixel.github.io/Kaam-Bazaar/" />
        </div>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="profile" class="card" style="display:none">
      <h3>Ù…ÛŒØ±ÛŒ Ù¾Ø±ÙˆÙØ§Ø¦Ù„</h3>
      <div class="row">
        <div class="col">
          <label>Ù†Ø§Ù…</label>
          <input id="p_name" placeholder="Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… Ù„Ú©Ú¾ÛŒÚº (Ù…Ø«Ø§Ù„: Ø§Ø­Ù…Ø¯)" />
          <label>ÙÙˆÙ† Ù†Ù…Ø¨Ø± (EasyPaisa/JazzCash)</label>
          <input id="p_mobile" placeholder="03XXXXXXXXX" />
          <label>Ù…Ø®ØªØµØ± ØªØ¹Ø§Ø±Ù</label>
          <textarea id="p_bio" rows="3" placeholder="Ù…ÛŒÚº Ú©ÙˆÙ† ÛÙˆÚº Ø§ÙˆØ± Ú©ÛŒØ§ Ú©Ø±ØªØ§ ÛÙˆÚº"></textarea>
          <button class="btn" onclick="saveProfile()">Ù¾Ø±ÙˆÙØ§Ø¦Ù„ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</button>
        </div>
        <div class="col">
          <h4>Ù¾Ø±ÙˆÙØ§Ø¦Ù„ Ù¾ÛŒØ´ Ù†Ø¸Ø§Ø±Û</h4>
          <div class="card" id="profilePreview">
            <div class="label" id="pv_name">Ù†Ø§Ù… Ù†ÛÛŒÚº Ù…Ù„Ø§</div>
            <div class="muted small" id="pv_mobile">ÙÙˆÙ† Ù†Ù…Ø¨Ø±</div>
            <p id="pv_bio" class="small muted">ØªØ¹Ø§Ø±Ù</p>
            <div style="margin-top:8px">
              <div>ÙˆØ§Ù„ÛŒÙ¹ Ø¨ÛŒÙ„Ù†Ø³: <b id="pv_balance">â‚¨0</b></div>
              <div style="margin-top:8px">
                <button class="btn-ghost" onclick="simulateTopupModal()">Wallet Ù…ÛŒÚº Ù¾ÛŒØ³Û’ ÚˆØ§Ù„ÛŒÚº</button>
                <button class="btn" onclick="showSection('wallet')">ÙˆØ§Ù„Ù¹ Ù¾Ø± Ø¬Ø§Ø¦ÛŒÚº</button>
              </div>
            </div>
          </div>
          <div class="muted small" style="margin-top:8px">Ù†ÙˆÙ¹: ÙˆØ§Ù„ÙÙ¹ Ø§ÙˆØ± ÙˆÛŒÚˆØ±Ø§ÙˆÙ„ Ø³Ø¨ demo Ù…ÛŒÚº Ú©Ù„Ø§Ø¦Ù†Ù¹-Ø³Ø§Ø¦ÛŒÚˆ Ø°Ø®ÛŒØ±Û ÛÙˆØªØ§ ÛÛ’ (localStorage)</div>
        </div>
      </div>
    </section>

    <!-- TASKS -->
    <section id="tasks" class="card" style="display:none">
      <h3>Ù¹Ø§Ø³Ú©Ø³ / Ú©Ø§Ù…</h3>

      <div class="row">
        <div class="col">
          <h4>Create Task (Ú©Ù„Ø§Ø¦Ù†Ù¹ Ú©Û’ Ù„ÛŒÛ’)</h4>
          <label>Ú©Ø§Ø± Ú©Ø§ Ø¹Ù†ÙˆØ§Ù†</label>
          <input id="t_title" placeholder="Ù…Ø«Ø§Ù„: Ù„Ø§Ú¯Ùˆ ÚˆÛŒØ²Ø§Ø¦Ù†" />
          <label>ØªÙØµÛŒÙ„</label>
          <textarea id="t_desc" rows="3" placeholder="Ú©Ø§Ù… Ú©ÛŒ ØªÙØµÛŒÙ„"></textarea>
          <label>Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ (Ø±ÙˆÙ¾Û’)</label>
          <input id="t_price" type="number" placeholder="Ù…Ø«Ø§Ù„: 1000" />
          <button class="btn" onclick="createTask()">Create & Pay (ÚˆÛŒÙ…Ùˆ Ù…ÛŒÚº ÙˆØ§Ù„Ù¹/Ù¾ÛŒÙ…Ù†Ù¹)</button>
        </div>

        <div class="col">
          <h4>Available Tasks</h4>
          <div id="taskList" class="small"></div>
        </div>
      </div>
    </section>

    <!-- WALLET -->
    <section id="wallet" class="card" style="display:none">
      <h3>ÙˆØ§Ù„Ù¹ / Withdraw</h3>
      <div class="row">
        <div class="col">
          <div class="card">
            <div class="label">Ù…ÛŒØ±Ø§ Ø¨ÛŒÙ„Ù†Ø³</div>
            <div style="font-size:20px;margin-top:8px">â‚¨ <span id="w_balance">0</span></div>
            <p class="muted small">Ù¾Ù„ÛŒÙ¹ ÙØ§Ø±Ù… Ú©Ù…ÛŒØ´Ù†: <span id="platformCommission">10%</span></p>
            <button class="btn" onclick="simulateTopupModal()">Wallet Ù…ÛŒÚº Ù¾ÛŒØ³Û’ ÚˆØ§Ù„ÛŒÚº (Demo)</button>
          </div>

          <div class="card" style="margin-top:10px">
            <h4>Withdraw Request</h4>
            <label>Ø±Ù‚Ù… (Ø±ÙˆÙ¾Û’)</label>
            <input id="wd_amount" type="number" placeholder="Ù…Ø«Ø§Ù„: 500" />
            <label>ÙÙˆÙ† Ù†Ù…Ø¨Ø± (Ø¬Ø³ Ù¾Ø± Ø¨Ú¾ÛŒØ¬Ù†Ø§ ÛÛ’)</label>
            <input id="wd_mobile" placeholder="03XXXXXXXXX" />
            <div style="margin-top:8px">
              <button class="btn" onclick="requestWithdraw()">Withdraw Request Ø¨Ú¾ÛŒØ¬ÛŒÚº</button>
            </div>
            <div class="muted small" style="margin-top:8px">Ù†ÙˆÙ¹: ÛŒÛ demo Ù…ÛŒÚº Admin approval Ú©Û’ Ø¨Ø¹Ø¯ payout simulate Ú©Ø±Û’ Ú¯Ø§Û”</div>
          </div>
        </div>

        <div class="col">
          <h4>Withdraw Requests</h4>
          <div id="withdrawList" class="small"></div>
        </div>
      </div>
    </section>

    <!-- ADMIN (PAYOUT placeholders) -->
    <section id="admin" class="card" style="display:none">
      <h3>Admin Panel (Ù¾Û’Ø¢Ø¤Ù¹ / Approve)</h3>

      <div class="row">
        <div class="col">
          <h4>Pending Withdrawals</h4>
          <div id="adminWithdraws" class="small"></div>
        </div>

        <div class="col">
          <h4>Integration Notes (Ø¬ÛØ§Úº Ø­Ù‚ÛŒÙ‚ÛŒ API Ù„Ú¯Ø§Ø¦ÛŒÚº)</h4>
          <div class="card small">
            <p><b>Important:</b> Ø§ØµÙ„ JazzCash / EasyPaisa integration Ø³Ø±ÙˆØ±-Ø³Ø§Ø¦Úˆ Ú©Ø±Ù†Ø§ ÛÙˆÚ¯Ø§ (Node/PHP/Python) â€” credentials client Ù¾Ø± Ù†ÛÛŒÚº Ø±Ú©Ú¾ÛŒÚºÛ”</p>
            <ol>
              <li>Server Ù¾Ø± endpoint Ø¨Ù†Ø§Ø¦ÛŒÚº: <code>POST /api/payout</code> â€” ÛŒÛ endpoint merchant credentials Ø³Û’ JazzCash/EasyPaisa Ú©Ùˆ Ú©Ø§Ù„ Ú©Ø±Û’ Ú¯Ø§Û”</li>
              <li>ÛŒÛ ÙØ§Ø¦Ù„ Ú©Û’ Ù†ÛŒÚ†Û’ function <code>performRealPayout()</code> Ù†Ø§Ù… Ú©Ø§ placeholder Ø¯ÛŒØ§ Ú¯ÛŒØ§ ÛÛ’Ø› Ø¬Ø¨ Ø¢Ù¾ server Ø¨Ù†Ø§ Ù„ÛŒÚº ØªÙˆ ÙˆÛØ§Úº fetch Ø³Û’ real API endpoint Ú©Ø§Ù„ Ú©Ø±ÛŒÚºÛ”</li>
              <li>Webhook: payment confirmations Ú©Û’ Ù„ÛŒÛ’ gateway Ú©Û’ webhooks Ú©Ùˆ server Ù¾Ø± handle Ú©Ø±ÛŒÚº ØªØ§Ú©Û Ù¾ÛŒÙ…Ù†Ù¹Ø³ auto verify ÛÙˆÚºÛ”</li>
            </ol>

            <p class="muted small">Ø§Ú¯Ø± Ø¢Ù¾ Ú†Ø§ÛÛŒÚº ØªÙˆ Ù…ÛŒÚº server-side code Ø¨Ú¾ÛŒ Ù„Ú©Ú¾ Ú©Ø± Ø¯Û’ Ø¯ÙˆÚº (Node.js Express example) â€” Ø¨ØªØ§Ø¦ÛŒÛ’ Ú©ÙˆÙ†Ø³ÛŒ Ø²Ø¨Ø§Ù† Ù¾Ø³Ù†Ø¯ ÛÛ’Û”</p>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div class="muted small">ÛŒÛ ÚˆÛŒÙ…Ùˆ ÙØ§Ø¦Ù„ Ù…Ù‚ØµÙˆØ¯Ø§Ù‹ client-side simulation Ø¯ÛŒØªÛŒ ÛÛ’ â€” Ø­Ù‚ÛŒÙ‚ÛŒ Ù¾ÛŒÙ…Ù†Ù¹ Ú©ÛŒÙ„Ø¦Û’ server-side integration Ø¶Ø±ÙˆØ±ÛŒ ÛÛ’Û”</div>
      <div style="margin-top:6px">Â© Ú©Ø§Ù… Ø¨Ø§Ø²Ø§Ø±</div>
    </footer>
  </div>

  <script>
    /* Simple demo platform state stored in localStorage so Ø¢Ù¾ copy/paste Ú©Û’ Ø¨Ø¹Ø¯ ÙÙˆØ±Ø§Ù‹ Ú©Ø§Ù… Ú©Ø±Û’ */
    const STATE_KEY = 'kaam_bazaar_demo_v1';

    function defaultState(){
      return {
        visitors: Math.floor(Math.random()*120+30),
        profile: {name:'', mobile:'', bio:'', balance:0},
        tasks: [], // each: {id,title,desc,price,client,freelancer,status:'open/assigned/completed'}
        withdraws: [], // each: {id,user,amount,mobile,status:'pending/approved/paid'}
        commissionPercent: 10
      };
    }

    // load/save
    function loadState(){ return JSON.parse(localStorage.getItem(STATE_KEY) || JSON.stringify(defaultState())); }
    function saveState(s){ localStorage.setItem(STATE_KEY, JSON.stringify(s)); renderAll(); }

    // init
    let state = loadState();
    function renderAll(){ state = loadState(); document.getElementById('visCount').innerText = state.visitors;
      document.getElementById('pv_name').innerText = state.profile.name || 'Ù†Ø§Ù… Ù†ÛÛŒÚº Ù…Ù„Ø§';
      document.getElementById('pv_mobile').innerText = state.profile.mobile || 'ÙÙˆÙ† Ù†Ù…Ø¨Ø±';
      document.getElementById('pv_bio').innerText = state.profile.bio || 'ØªØ¹Ø§Ø±Ù Ø¯Ø³ØªÛŒØ§Ø¨ Ù†ÛÛŒÚº';
      document.getElementById('pv_balance').innerText = 'â‚¨' + (state.profile.balance || 0);
      document.getElementById('w_balance').innerText = (state.profile.balance || 0);
      document.getElementById('platformCommission').innerText = state.commissionPercent + '%';
      renderTasks(); renderWithdraws(); renderAdminWithdraws();
      document.getElementById('refLink').value = location.href;
    }

    // nav
    function showSection(id){ document.querySelectorAll('section').forEach(s=>s.style.display='none'); document.getElementById(id).style.display='block'; }
    showSection('home');

    // profile
    function saveProfile(){
      const s = loadState();
      s.profile.name = document.getElementById('p_name').value.trim();
      s.profile.mobile = document.getElementById('p_mobile').value.trim();
      s.profile.bio = document.getElementById('p_bio').value.trim();
      saveState(s);
      alert('Ù¾Ø±ÙˆÙØ§Ø¦Ù„ Ù…Ø­ÙÙˆØ¸ ÛÙˆÚ¯ÛŒØ§');
    }

    // tasks
    function createTask(){
      const s = loadState();
      const title = document.getElementById('t_title').value.trim();
      const desc = document.getElementById('t_desc').value.trim();
      const price = Number(document.getElementById('t_price').value || 0);
      if(!title || !price){ alert('Ø¹Ù†ÙˆØ§Ù† Ø§ÙˆØ± Ù‚ÛŒÙ…Øª Ø¯ÛŒÚº'); return; }
      const id = 'T' + Date.now();
      // Demo: Ù¾ÛŒÙ…Ù†Ù¹ simulate Ú©Ø±ÛŒÚº â€” ÛŒÛØ§Úº Ø¢Ù¾ Ø­Ù‚ÛŒÙ‚ÛŒ gateway Ú©Û’ Ø³Ø§ØªÚ¾ redirect Ú©Ø±ÛŒÚº Ú¯Û’
      const confirmPay = confirm(`Ø¢Ù¾ ${price} Ø±ÙˆÙ¾Û’ Ø§Ø¯Ø§ Ú©Ø±ÛŒÚº Ú¯Û’ (Demo). Continue?`);
      if(!confirmPay) return;
      // simulate: reduce client's balance? in demo we'll assume client paid externally and escrow holds money
      // store task with escrowPaid = true
      s.tasks.push({id,title,desc,price,client:s.profile.name || 'Client', freelancer:'', status:'open', escrowPaid:true});
      s.visitors += 1;
      saveState(s);
      alert('Ù¹Ø§Ø³Ú© Ø¨Ù†Ø§ÛŒØ§ Ú¯ÛŒØ§ Ø§ÙˆØ± Ù¾ÛŒÙ…Ù†Ù¹ Escrow Ù…ÛŒÚº Ø±Ú©Ú¾Ø§ Ú¯ÛŒØ§ (Demo). Ø§Ø¨ Ú©ÙˆØ¦ÛŒ Freelancer Ø§Ø³Û’ Ù‚Ø¨ÙˆÙ„ Ú©Ø± Ø³Ú©Û’ Ú¯Ø§.');
      document.getElementById('t_title').value=''; document.getElementById('t_desc').value=''; document.getElementById('t_price').value='';
    }

    function renderTasks(){
      const s = loadState();
      const el = document.getElementById('taskList'); el.innerHTML='';
      if(s.tasks.length===0){ el.innerHTML='<div class="muted small">Ú©ÙˆØ¦ÛŒ Ù¹Ø§Ø³Ú© Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº</div>'; return; }
      s.tasks.slice().reverse().forEach(t=>{
        const div = document.createElement('div'); div.className='task';
        div.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
          <div><b>${t.title}</b><div class="muted small">${t.desc}</div></div>
          <div style="text-align:right"><div>â‚¨ ${t.price}</div><div class="muted small">${t.status}</div></div>
        </div>`;
        const btnRow = document.createElement('div'); btnRow.style.marginTop='8px';
        if(t.status==='open'){
          const acc = document.createElement('button'); acc.className='btn-ghost'; acc.innerText='Accept as Freelancer'; acc.onclick=()=>acceptTask(t.id);
          btnRow.appendChild(acc);
        } else if(t.status==='assigned'){
          const done = document.createElement('button'); done.className='btn'; done.innerText='Mark as Completed (Freelancer)'; done.onclick=()=>completeTask(t.id);
          btnRow.appendChild(done);
        } else if(t.status==='completed'){
          const rel = document.createElement('button'); rel.className='btn'; rel.innerText='Release Payment (Client)'; rel.onclick=()=>releasePayment(t.id);
          btnRow.appendChild(rel);
        }
        div.appendChild(btnRow);
        el.appendChild(div);
      });
    }

    function acceptTask(id){
      const s = loadState();
      const t = s.tasks.find(x=>x.id===id);
      if(!t) return alert('Ù¹Ø§Ø³Ú© Ù†ÛÛŒÚº Ù…Ù„Ø§');
      const freelancer = prompt('Ø§Ù¾Ù†Ø§ Ù†Ø§Ù… Ø¨Ø·ÙˆØ± Freelancer Ù„Ú©Ú¾ÛŒÚº:','Freelancer');
      if(!freelancer) return;
      t.freelancer = freelancer;
      t.status = 'assigned';
      saveState(s);
      alert('Ù¹ÛŒ Ø³Ú© Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„ ÛÙˆ Ú¯ÛŒØ§ â€” Ø§Ø¨ Ú©Ø§Ù… Ù…Ú©Ù…Ù„ Ú©Ø±ÛŒÚº Ø§ÙˆØ± Mark as Completed Ú©Ø±ÛŒÚºÛ”');
    }

    function completeTask(id){
      const s = loadState();
      const t = s.tasks.find(x=>x.id===id);
      if(!t) return;
      t.status = 'completed';
      saveState(s);
      alert('Ú©Ø§Ù… Ù…Ø§Ø±Ú© Ú©ÛŒØ§ Ú¯ÛŒØ§ Completed Ú©Û’ Ø·ÙˆØ± Ù¾Ø±Û” Ú©Ù„Ø§Ø¦Ù†Ù¹ Release Ú©Ø± Ú©Û’ Ù¾ÛŒÙ…Ù†Ù¹ Ø±ÛŒÙ„ÛŒØ² Ú©Ø±Û’ Ú¯Ø§Û”');
    }

    // release payment: client releases escrow -> platform cuts commission -> freelancer balance Ø¨Ú‘Ú¾ØªØ§ ÛÛ’
    function releasePayment(id){
      const s = loadState();
      const t = s.tasks.find(x=>x.id===id);
      if(!t) return;
      if(!t.escrowPaid) return alert('Escrow Ù…ÛŒÚº Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛÛŒÚº');
      const confirmRel = confirm('Ú©ÛŒØ§ Ø¢Ù¾ ÙˆØ§Ù‚Ø¹ÛŒ Ù¾ÛŒÙ…Ù†Ù¹ release Ú©Ø±Ù†Ø§ Ú†Ø§ÛØªÛ’ ÛÛŒÚºØŸ (Platform commission: ' + s.commissionPercent + '%)');
      if(!confirmRel) return;
      const commission = Math.round(t.price * s.commissionPercent / 100);
      const pay = t.price - commission;
      // find freelancer by name; if freelancer matches current profile name, add to own balance, else we'll store in withdraws as unpaid to another user (demo simplification)
      if(s.profile.name && s.profile.name === t.freelancer){
        s.profile.balance = (s.profile.balance||0) + pay;
      } else {
        // create a pseudo user balance stored in withdraws array for that freelancer
        s.withdraws.push({id:'W_auto_'+Date.now(), user:t.freelancer, amount:pay, mobile:'(unknown)', status:'pending', note:'Auto credit for '+t.id});
      }
      t.escrowPaid = false;
      t.status = 'paid';
      s.visitors += 1;
      saveState(s);
      alert('Payment released. Platform commission taken: â‚¨' + commission + '. Freelancer Ú©Ùˆ Ø¨ÛŒÙ„Ù†Ø³ ÛŒØ§ withdraw Ú©Û’ Ø°Ø±ÛŒØ¹Û’ Ø±Ù‚Ù… Ù…Ù„Û’ Ú¯ÛŒ (Demo).');
    }

    // WALLET simulate top-up
    function simulateTopupModal(){
      const amount = Number(prompt('Wallet Ù…ÛŒÚº Ú©ØªÙ†Û’ Ø±ÙˆÙ¾Û’ ÚˆØ§Ù„ÛŒÚºØŸ (Demo) Ù…Ø«Ø§Ù„: 1000',500));
      if(!amount || amount<=0) return;
      const s = loadState();
      s.profile.balance = (s.profile.balance||0) + amount;
      s.visitors += 1;
      saveState(s);
      alert('Wallet Ù…ÛŒÚº Ø¬Ù…Ø¹ ÛÙˆ Ú¯ÛŒØ§ (Demo): â‚¨' + amount);
    }

    // withdraw request
    function requestWithdraw(){
      const s = loadState();
      const amount = Number(document.getElementById('wd_amount').value || 0);
      const mobile = document.getElementById('wd_mobile').value.trim();
      if(!amount || amount<=0) return alert('ØµØ­ÛŒØ­ Ø±Ù‚Ù… Ø¯ÛŒÚº');
      if(!mobile) return alert('ÙÙˆÙ† Ù†Ù…Ø¨Ø± Ø¯ÛŒÚº');
      if((s.profile.balance||0) < amount) return alert('Ø¢Ù¾ Ú©Û’ ÙˆØ§Ù„Ù¹ Ù…ÛŒÚº Ø¨ÛŒÙ„Ù†Ø³ Ú©Ù… ÛÛ’');
      // create withdraw request (pending)
      const id = 'WD' + Date.now();
      s.withdraws.push({id,user:s.profile.name||'You', amount, mobile, status:'pending'});
      // reduce user balance immediately or keep until paid? We'll deduct on approve to simulate safety.
      // For demo keep balance until admin approves; so user sees pending.
      saveState(s);
      alert('Withdraw request Ø¨Ú¾ÛŒØ¬ Ø¯ÛŒ Ú¯Ø¦ÛŒÛ” Admin Ø³Û’ approval Ú©Ø§ Ø§Ù†ØªØ¸Ø§Ø± Ú©Ø±ÛŒÚºÛ”');
      document.getElementById('wd_amount').value=''; document.getElementById('wd_mobile').value='';
    }

    function renderWithdraws(){
      const s = loadState();
      const el = document.getElementById('withdrawList'); el.innerHTML='';
      if(s.withdraws.length===0){ el.innerHTML='<div class="muted small">Ú©ÙˆØ¦ÛŒ withdraw request Ù†ÛÛŒÚº</div>'; return; }
      s.withdraws.slice().reverse().forEach(w=>{
        const div = document.createElement('div'); div.className='task';
        div.innerHTML = `<div><b>${w.user}</b> Ù†Û’ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©ÛŒ â€” â‚¨ ${w.amount} â€” ${w.mobile}</div><div class="muted small">Status: ${w.status}</div>`;
        el.appendChild(div);
      });
    }

    // admin view for withdraws
    function renderAdminWithdraws(){
      const s = loadState();
      const el = document.getElementById('adminWithdraws'); el.innerHTML='';
      const pending = s.withdraws.filter(x=>x.status==='pending');
      if(pending.length===0){ el.innerHTML='<div class="muted small'>Ú©ÙˆØ¦ÛŒ pending payouts Ù†ÛÛŒÚº</div>'; return; }
      pending.forEach(w=>{
        const div = document.createElement('div'); div.className='task';
        div.innerHTML = `<div><b>${w.user}</b> â€” â‚¨${w.amount} â€” ${w.mobile}</div><div class="muted small">ID: ${w.id}</div>`;
        const approve = document.createElement('button'); approve.className='btn'; approve.style.marginTop='8px'; approve.innerText='Approve & Pay (Simulate)';
        approve.onclick = ()=>adminApprove(w.id);
        const reject = document.createElement('button'); reject.className='btn-ghost'; reject.style.marginTop='8px'; reject.style.marginLeft='8px'; reject.innerText='Reject';
        reject.onclick = ()=>adminReject(w.id);
        div.appendChild(approve); div.appendChild(reject);
        el.appendChild(div);
      });
    }

    // Admin approve: here we simulate a server-side payout call.
    function adminApprove(id){
      const s = loadState();
      const w = s.withdraws.find(x=>x.id===id);
      if(!w) return alert('Ø±ÛŒÚ©Ø§Ø±Úˆ Ù†ÛÛŒÚº Ù…Ù„Ø§');
      // Before paying: check balance for that user (demo: if same as current profile, deduct; otherwise we assume external)
      if(s.profile.name === w.user){
        if((s.profile.balance||0) < w.amount) return alert('User balance Ú©Ù… ÛÛ’ (admin simulate)');
        // Deduct and mark paid
        s.profile.balance -= w.amount;
        w.status = 'paid';
        w.paidAt = new Date().toISOString();
        // Simulate payout by calling performRealPayout placeholder
        performRealPayout(w).then(res=>{
          // In demo, success always
          saveState(s);
          alert('Payout simulated as successful. ØµØ§Ø±Ù Ú©Ùˆ Ù¾ÛŒØ³Û’ Ø¨Ú¾ÛŒØ¬ Ø¯ÛŒÛ’ Ú¯Ø¦Û’ (Demo).');
        }).catch(err=>{
          alert('Payout failed (demo): ' + err);
        });
      } else {
        // If freelancer is other user, mark as paid but in real app you would call server to pay their mobile via JazzCash/EasyPaisa
        w.status = 'paid';
        w.paidAt = new Date().toISOString();
        saveState(s);
        alert('Payout marked paid (Demo) â€” Ø­Ù‚ÛŒÙ‚ÛŒ system Ù…ÛŒÚº server Ø³Û’ JazzCash/EasyPaisa call Ú©Ø±ÛŒÚºÛ”');
      }
    }

    function adminReject(id){
      const s = loadState();
      const w = s.withdraws.find(x=>x.id===id);
      if(!w) return;
      w.status = 'rejected';
      saveState(s);
      alert('Request rejected');
    }

    // Placeholder for real payout: here we simulate async call
    async function performRealPayout(withdrawObj){
      /* ===== IMPORTANT =====
         ÛŒÛ Ø¬Ú¯Û ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±ÛŒÚº Ø¬Ø¨ Ø¢Ù¾ Ú©Û’ Ù¾Ø§Ø³ backend ÛÙˆ:
         - Ø¢Ù¾ Ú©Ùˆ server Ù¾Ø± endpoint Ø¨Ù†Ø§Ù†Ø§ ÛÙˆÚ¯Ø§: POST /api/payout
         - server Ø§Ù¾Ù†Û’ JazzCash/EasyPaisa credentials Ø³Û’ Ø­Ù‚ÛŒÙ‚ÛŒ payout Ú©Ø±Û’ Ú¯Ø§ Ø§ÙˆØ± success/fail ÙˆØ§Ù¾Ø³ Ú©Ø±Û’ Ú¯Ø§
         - ÛŒÛØ§Úº fetch Ø³Û’ ÙˆÛ endpoint call Ú©Ø±ÛŒÚº Ø§ÙˆØ± response handle Ú©Ø±ÛŒÚº

         Example (server ready ÛÙˆÙ†Û’ Ù¾Ø±):
         return fetch('https://yourserver.com/api/payout', {
           method:'POST',
           headers:{'Content-Type':'application/json','Authorization':'Bearer <ADMIN_TOKEN>'},
           body: JSON.stringify({mobile: withdrawObj.mobile, amount: withdrawObj.amount, reference: withdrawObj.id})
         }).then(r=>r.json());
      */
      // demo: wait 1s then resolve success
      return new Promise((resolve)=> setTimeout(()=>resolve({ok:true, message:'Demo payout success'}), 1000));
    }

    // share (simple)
    function share(type){
      const url = encodeURIComponent(location.href);
      const text = encodeURIComponent('Ú©Ø§Ù… Ø¨Ø§Ø²Ø§Ø± Ø¯ÛŒÚ©Ú¾ÛŒÚº â€” Ø³ÛŒÚ©Ú¾ÙˆØŒ Ú©Ø§Ù… Ú©Ø±ÙˆØŒ Ú©Ù…Ø§Ø¤!');
      if(type==='facebook') window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`,'_blank');
      if(type==='twitter') window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`,'_blank');
      if(type==='whatsapp') window.open(`https://api.whatsapp.com/send?text=${text}%20${url}`,'_blank');
    }

    // increase visitors on open (demo)
    window.addEventListener('load', ()=>{ const s=loadState(); s.visitors = (s.visitors||0)+1; saveState(s); });

    // initial render
    renderAll();

    // Expose some functions to console for easier testing
    window.__kb = {loadState, saveState, defaultState};
  </script>
</body>
</html>
